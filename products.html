<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Productos - Vidriería (mejorado)</title>
<link rel="stylesheet" href="styles_cart_modal.css">
</head>
<body>
<header style="padding:12px;border-bottom:1px solid #eee;">
  <a href="index.html">Inicio</a> | <a href="dashboard.html">Dashboard</a> | <a href="cart.html">Carrito</a>
  <span style="float:right">Carrito: <span class="cart-count">0</span></span>
</header>

<main style="padding:16px;">
  <h1>Productos</h1>
  <div id="product-list" style="display:flex;gap:12px;flex-wrap:wrap;"></div>

  <!-- Modal for product detail + zoom -->
  <div id="product-modal" aria-hidden="true">
    <div class="modal-card">
      <div>
        <img id="modal-img" class="modal-img" src="" alt="Imagen producto"/>
      </div>
      <div class="modal-content">
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <p><strong>Precio: L. <span id="modal-price"></span></strong></p>
        <p>
          <button id="modal-add">Agregar al carrito</button>
          <button id="modal-remove">Simular eliminar del catálogo</button>
          <button id="modal-close">Cerrar</button>
        </p>
      </div>
    </div>
  </div>

</main>

<script src="js/cart.js"></script>
<script>
// Sample products (edit or replace with your real data)
const PRODUCTS = [
  {id: "p1", name: "Vidrio Templado 50x50", price: 250.00, desc: "Vidrio templado resistente, 50x50 cm con acabado pulido.", img: "img/vidrio-a.jpg"},
  {id: "p2", name: "Vidrio Laminado 80x60", price: 400.00, desc: "Vidrio laminado para mayor seguridad, ideal para ventanas y puertas.", img: "img/vidrio-b.jpg"},
  {id: "p3", name: "Espejo Biselado 100x60", price: 600.00, desc: "Espejo con bisel acabado profesional, 100x60 cm.", img: "img/espejo-c.jpg"},
  {id: "p4", name: "Vidrio Transparente 60x40", price: 180.00, desc: "Vidrio económico para proyectos de bricolaje.", img: "img/vidrio-d.jpg"}
];

// Render product cards, hiding removed ones
function renderProducts(){
  const removed = loadRemoved();
  const wrap = document.getElementById("product-list");
  wrap.innerHTML = "";
  PRODUCTS.forEach(p=>{
    if(removed.includes(p.id)) return; // skip removed
    const card = document.createElement("div");
    card.className = "card";
    card.style.width = "240px";
    card.innerHTML = `
      <img src="${p.img}" alt="${p.name}" style="width:100%;height:140px;object-fit:cover;cursor:pointer" data-product-id="${p.id}" />
      <h3>${p.name}</h3>
      <p>${p.desc.substring(0,80)}...</p>
      <p><strong>L. ${p.price.toFixed(2)}</strong></p>
      <p>
        <button data-product='${JSON.stringify({id:p.id,name:p.name,price:p.price})}' data-add-to-cart>Agregar</button>
        <button onclick="openProductModal('${p.id}')">Ver detalle</button>
        <button data-remove-product="${p.id}">Simular eliminar</button>
      </p>
    `;
    wrap.appendChild(card);
  });

  // Attach click on images to open modal + zoom
  document.querySelectorAll("[data-product-id]").forEach(img=>{
    img.addEventListener("click", function(){
      const id = this.getAttribute("data-product-id");
      openProductModal(id, true);
    });
  });
}

// Modal logic
function openProductModal(id, zoomImage=false){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  document.getElementById("modal-img").src = p.img;
  document.getElementById("modal-title").textContent = p.name;
  document.getElementById("modal-desc").textContent = p.desc;
  document.getElementById("modal-price").textContent = p.price.toFixed(2);
  document.getElementById("modal-add").onclick = function(){ addToCart({id:p.id,name:p.name,price:p.price}); };
  document.getElementById("modal-remove").onclick = function(){ if(confirm('Simular eliminación del producto?')){ removeProductFromCatalog(p.id); closeModal(); } };
  document.getElementById("modal-close").onclick = closeModal;
  const modal = document.getElementById("product-modal");
  modal.classList.add("open");
  // zoom toggle on img click
  const imgEl = document.getElementById("modal-img");
  imgEl.classList.remove("zoomed");
  imgEl.onclick = function(){
    this.classList.toggle("zoomed");
  };
  // optional: if opened by image click, auto zoom a bit
  if(zoomImage) setTimeout(()=>{ imgEl.classList.add("zoomed"); }, 220);
}

function closeModal(){
  const modal = document.getElementById("product-modal");
  modal.classList.remove("open");
  const imgEl = document.getElementById("modal-img");
  if(imgEl) imgEl.classList.remove("zoomed");
}

// Initialize
document.addEventListener("DOMContentLoaded", function(){
  renderProducts();
  renderCartCount();
  // render cart drawer UI exists from cart.js
});
</script>
</body>
</html>
